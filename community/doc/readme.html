<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Community Service</title>
  <meta http-equiv="content-type"
 content="text/html; charset=ISO-8859-1">
</head>
<body>
<h1>Community Service</h1>
<h2>1. &nbsp;Overview</h2>
Communities provide a way of segmenting societies into distinct groups
of entities organized for specific purposes. &nbsp;A typical use of
communities is to define a group of agents that will be used as a
destination address for a Blackboard Relay. &nbsp;In addition to
providing a way to define simple groups of agents, communities and
their associated entities may also be associated with attributes that
can be used to select a specific community member or subgroup. &nbsp;
For instance, given the community defined below, an Attribute Based
Address (ABA) could be defined to send a Relay to all members in
CommunityA using the "Role=Member" criteria. &nbsp;Alternately, the ABA
could be addressed to those members having the "Role=Role-A" attribute
in which case only Agent-2 and Agent-3 would receive the Relay.<br>
<br>
<small><code>&nbsp; &lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>
&nbsp; &lt;Communities&gt;<br>
&nbsp; &nbsp; &lt;Community Name="CommunityA"&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-1"&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-2"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role"
Value="Role-A" /&gt;<br>
&nbsp;&nbsp; &nbsp;&nbsp; &lt;/Entity&gt;<br>
&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entity Name="Agent-3"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Role-A"
/&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Role-C"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-4"&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Role-B"
/&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Role-C"
/&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&lt;/Entity&gt;<br>
&nbsp; &nbsp; &lt;/Community&gt;<br>
&nbsp; &lt;/Communities&gt;<br>
</code></small> <br>
In addition to agents, communities may also include other communities.
The example below shows an XML configuration for a nested community.
&nbsp;In this example CommunityA contains 4 agents and one nested
community (CommunityB). &nbsp;Community B contains 2 member agents and
it also has a nested community (CommunityC) which contains 2 agents.
&nbsp;The search capabilities provided by the Community Service support
both single-level and recursive searches. &nbsp;Using this example a
search for member agents in CommunityA would return
[Agent-1,Agent-2,Agent-3,Agent-4] if the <i>recursiveSearch </i>parameter
was set to false. &nbsp;If the parameter was set to true all 8 agents
contained in CommunityA, CommunityB, and CommunityC would be returned.
&nbsp;Note that when using ABAs a recusive search is automatically
performed in agent selection.<br>
<br>
<small><code>&nbsp; &lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>
&nbsp; &lt;Communities&gt;<br>
&nbsp; &nbsp; &lt;Community Name="CommunityA"&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-1"&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-2"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp;&nbsp; &nbsp;&nbsp; &lt;/Entity&gt;<br>
&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entity Name="Agent-3"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-4"&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&lt;/Entity&gt;<br>
</code><code> &nbsp; &nbsp; &nbsp; &lt;Entity Name="CommunityB"&gt;<br>
</code><code> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute
ID="EntityType" Value="Community" /&gt;<br>
</code><code> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role"
Value="Member" /&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&lt;/Entity&gt;<br>
</code><code> &nbsp; &nbsp; &lt;/Community&gt;<br>
</code><code> &nbsp; &nbsp; &lt;Community Name="CommunityB"&gt;<br>
</code><code>&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entity Name="Agent-5"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
</code><code>&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entity Name="Agent-6"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
</code><code></code><code> &nbsp; &nbsp; &nbsp; &lt;Entity
Name="CommunityC"&gt;<br>
</code><code> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute
ID="EntityType" Value="Community" /&gt;<br>
</code><code> &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role"
Value="Member" /&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&lt;/Entity&gt;<br>
</code><code> &nbsp;</code><code> &nbsp; &lt;/Community&gt;<br>
</code><code></code><code> &nbsp; &nbsp; &lt;Community
Name="CommunityC"&gt;<br>
</code><code>&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entity Name="Agent-7"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
</code><code>&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entity Name="Agent-8"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
</code><code></code><code></code><code></code><code> &nbsp;</code><code>
&nbsp; &lt;/Community&gt;<br>
</code><code> &nbsp; &lt;/Communities&gt;</code><br>
</small>
<h2>2. &nbsp;Forming communities</h2>
<h3>2.1. &nbsp;Startup communities</h3>
During society startup communities may automatically be created using a
startup configuration file named "communities.xml" which resides on the
Cougaar config path. In addition to the existence of a communities.xml
file the org.cougaar.community.CommunityPlugin component must also be
loaded if the automatic creation of startup communities is required.
&nbsp; The CommunityPlugin will automatically submit JOIN requests on
behalf of the local agent to create/populate startup
communities found in the communities.xml file.<br>
<h3>2.2. &nbsp;Ad-hoc communities</h3>
In addition to the initial communities defined in a startup
configuration, communities may also be created at run time. &nbsp;The
Community Service API provides <span style="font-style: italic;">join</span>
and <span style="font-style: italic;">leave</span> operations
supporting
the capability to dynamically create and populate communities.
&nbsp;For
example, suppose that Agent-1 wanted to join a new community (i.e.,
CommunityX), it would call the CommunityService.join method to join the
community.&nbsp; If the community did not exist and the
createIfNotFound parameter on the join request was set to true the
community would be created and the requesting agent would be added as a
member.&nbsp; If the community already had already been
created by another agent, the Join request would be forwarded to the
associated Community Manager and Agent-1 would be added to the
community.<br>
<h3>2.3. &nbsp;Community definition</h3>
Communities are defined using a couple simple constructs. &nbsp;<br>
<ul>
  <li>At the top-level a Community consists of a unique name, zero or
more attributes, and zero or more child entities.</li>
  <li>Each child entity has a unique name and is associated with zero
or more attributes. &nbsp;Child entities are described using their
associated attributes. &nbsp;The attribute "EntityType" has a
special meaning when constructing communities. &nbsp;The attribute
"EntityType" will define whether the entity is an agent or a nested
community. &nbsp;The value for this attribute must either be "Agent"
or "Community". &nbsp;If the attribute is not specified the value
"Agent" is assumed.&nbsp; <br>
  </li>
  <li>Community and entity ttributes are defined using the
javax.naming.directory class which defines an attribute set consisting
of zero or more javax.naming.directory.Attribute instances. &nbsp;An
Attribute consists of an identifier and zero or more values.&nbsp;</li>
</ul>
The folowing code fragment defines the DTD rules for defining a
community in XML.<br>
<div style="margin-left: 40px;"><small><code> &lt;?xml version="1.0"
encoding="UTF-8"?&gt;</code></small><br>
<small><code> &lt;!DOCTYPE Communities [</code></small><br>
<small><code> &lt;!ELEMENT Communities (Community+)&gt;</code></small><br>
<small><code> &lt;!ELEMENT Community (Attribute*, Entity*)&gt;</code></small><br>
<small><code> &lt;!ATTLIST Community Name CDATA #REQUIRED&gt;</code></small><br>
<small><code></code></small><small><code></code></small><small><code>&lt;!ELEMENT
Entity (Attribute*)&gt;</code></small><br>
<small><code> &lt;!ATTLIST Entity Name CDATA #REQUIRED&gt;</code></small><small><code></code></small><br>
<small><code> &lt;!ELEMENT Attribute EMPTY&gt;</code></small><br>
<small><code> &lt;!ATTLIST Attribute ID CDATA #REQUIRED&gt;</code></small><br>
<small><code> &lt;!ATTLIST Attribute Value CDATA #REQUIRED&gt;</code></small><br>
<small><code> ]&gt;</code></small><br>
<small><code> </code></small></div>
<h2>3. &nbsp;Community Service API</h2>
This section defines the programming inferface for interactiing with
the community services.<br>
<br>
<h3>3.2. &nbsp;CommunityService interface</h3>
Community service operations are performed using the
org.cougaar.core.service.community.CommunityService interface that can
be obtained from a components Service Broker. &nbsp;The
CommunityService
interface provides a set of methods providing agents with the cpability
to join/leave a community, modify community/entity attributes, get
community state, add/remove listeners, and search for communities based
on user-specified criteria. &nbsp;All methods
are implemented as non-blocking calls. &nbsp;Responses are returned
using a callback to a CommunityResponseListener instance.&nbsp; For a
complete list of CommunityService methods and a brief description of
their usage refer to the javadoc for
org.cougaar.core.service.community.CommunityService.<br>
<h3>3.3. &nbsp;Community search filter syntax &nbsp;</h3>
<span style="font-style: italic;">Information in this section was
extracted from Sun's JNDI Tutorial (</span><a
 href="http://java.sun.com/products/jndi/tutorial/basics/directory/filter.html">http://java.sun.com/products/jndi/tutorial/basics/directory/filter.html</a><span
 style="font-style: italic;">).</span><br>
<br>
The search filter syntax is basically a logical expression in prefix
notation (that is, the logical operator appears before its arguments).
The following table lists the symbols used for creating filters.
<p>
<table border="1" cellpadding="3" width="85%">
  <tbody>
    <tr>
      <th width="30%">Symbol</th>
      <th>Description</th>
    </tr>
    <tr>
      <td> &amp; </td>
      <td> conjunction (i.e., <em>and</em> -- all in list must be
true) </td>
    </tr>
    <tr>
      <td> | </td>
      <td> disjunction (i.e., <em>or</em> -- one or more alternatives
must be true) </td>
    </tr>
    <tr>
      <td> ! </td>
      <td> negation (i.e., <em>not</em> -- the item being negated must
not be true) </td>
    </tr>
    <tr>
      <td> = </td>
      <td> equality (according to the matching rule of the attribute) </td>
    </tr>
    <tr>
      <td> ~= </td>
      <td> approximate equality (according to the matching rule of the
attribute) </td>
    </tr>
    <tr>
      <td> &gt;= </td>
      <td> greater than (according to the matching rule of the
attribute) </td>
    </tr>
    <tr>
      <td> &lt;= </td>
      <td> less than (according to the matching rule of the attribute) </td>
    </tr>
    <tr>
      <td> =* </td>
      <td> presence (i.e., the entry must have the attribute but its
value is irrelevant) </td>
    </tr>
    <tr>
      <td> * </td>
      <td> wildcard (indicates zero or more characters can occur in
that
position); used when specifying attribute values to match </td>
    </tr>
    <tr>
      <td> \ </td>
      <td> escape (for escaping '*', '(', or ')' when they occur inside
an attribute value) </td>
    </tr>
  </tbody>
</table>
</p>
<p> Each item in the filter is composed using an attribute identifier
and either an attribute value or symbols denoting the attribute value.
For example, the item <tt>"Role=Member"</tt> means that the <tt>"Role"</tt>
attribute must have the attribute value <tt>"Member" </tt>and the
item <tt>"FuelProvider=*"</tt>
indicates that the <tt>"FuelProvider"</tt> attribute must be present. </p>
<p> Each item must be enclosed within a set of parentheses, as in <tt>"(Role=Member)"</tt>.
These items are composed using logical operators such as "&amp;"
(conjunction) to create logical expressions, as in <tt>"(&amp;
(Role=Member) (FuelProvider=*))"</tt>. </p>
<p> Each logical expression can be further composed of other items that
themselves are logical expressions, as in <tt>"(| (&amp; (Role=Member)
(FuelProvider=*)) (Unit=L*))"</tt>. This last example is requesting
either entries that have both a <tt>"Role"</tt> attribute of <tt>"Member"</tt>
and the <tt>"FuelProvider"</tt> attribute or entries whose <tt>"Unit"</tt>
attribute begins with the letter "L." </p>
<p> For a complete description of the syntax, see <a
 href="http://www.ietf.org/rfc/rfc2254.txt">RFC 2254</a>. </p>
<h3>3.4. &nbsp;Activation of community service support</h3>
The only prerequisite for using community services is that a
CommunityService service provider be loaded prior to use.&nbsp; This is
typically performed by the cougaar infrastructure when an agent is
started.&nbsp;&nbsp; Optionally, the CommunityPlugin component must
also be loaded if the automatic creation of startup communities is
required.<br>
<h2>4. &nbsp;Community Managers</h2>
A community manager is associated with each community. &nbsp;The
community manager is responsible for maintaining the master copy of the
Community instance used to define the communities entities and
attributes. &nbsp;The community manager is also responsible for
dessiminating a copy of this Community descriptor to child agents and
other interested agents (for instance agents that use the community as
an ABA target). &nbsp;Each community has a single community manager.
&nbsp;The community manager may be explictily specified or may be
dynamically selected at runtime. &nbsp;To explicitly specify a
community
manager the community-level attribute "CommunityManager" should be set
to the name of the designated agent. &nbsp;For instance, in the
following example Agent-1 is the designated community manager for
CommunityA. &nbsp;If the CommunityManager attribute is not specified
the
first member agent that is started will assume this role.<br>
<br>
<small><code>&nbsp; &lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>
&nbsp; &lt;Communities&gt;<br>
&nbsp; &nbsp; &lt;Community Name="CommunityA"&gt;<br>
</code></small><small><code> &nbsp; &nbsp;&nbsp; &nbsp;&lt;Attribute
ID="CommunityManager" Value="Agent-1" /&gt;<br>
</code></small><small><code> &nbsp; &nbsp; &nbsp; &lt;Entity
Name="Agent-1"&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-2"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp;&nbsp; &nbsp;&nbsp; &lt;/Entity&gt;<br>
&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entity Name="Agent-3"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-4"&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&lt;/Entity&gt;<br>
&nbsp; &nbsp; &lt;/Community&gt;<br>
&nbsp; &lt;/Communities&gt;<br>
<br>
</code></small> If a community manager should be dynamically selected
from a subset of the community members, the attribute "CanBeManager"
can
be associated with individual member agents to indicate whether the
agent is capable of being the community manager. &nbsp;The value of
"False" or "No" is used to inhibit selection of an agent. &nbsp;If the
attribute is not specified its value is assumed to be "True". &nbsp;For
instance, in the following example the community manager for CommunityA
will be selected from agents 1 and 3. <br>
<br>
<small><code>&nbsp; &lt;?xml version="1.0" encoding="UTF-8"?&gt;<br>
&nbsp; &lt;Communities&gt;<br>
&nbsp; &nbsp; &lt;Community Name="CommunityA"&gt;</code></small><small><code>
<br>
</code></small><small><code> &nbsp; &nbsp; &nbsp; &lt;Entity
Name="Agent-1"&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;/Entity&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-2"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
</code></small><small><code> &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;
&lt;Attribute ID="CanBeManager" Value="False" /&gt;<br>
</code></small><small><code> &nbsp;&nbsp; &nbsp;&nbsp; &lt;/Entity&gt;<br>
&nbsp;&nbsp; &nbsp;&nbsp; &lt;Entity Name="Agent-3"&gt;<br>
&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
</code></small><small><code> &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;
&lt;Attribute ID="CanBeManager" Value="True" /&gt;<br>
</code></small><small><code></code></small><small><code> &nbsp; &nbsp;
&nbsp; &lt;/Entity&gt;<br>
&nbsp; &nbsp; &nbsp; &lt;Entity Name="Agent-4"&gt;<br>
&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;Attribute ID="Role" Value="Member"
/&gt;<br>
</code></small><small><code> &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;
&lt;Attribute ID="CanBeManager" Value="False" /&gt;<br>
</code></small><small><code></code></small><small><code> &nbsp;
&nbsp;&nbsp; &nbsp;&lt;/Entity&gt;<br>
&nbsp; &nbsp; &lt;/Community&gt;<br>
&nbsp; &lt;/Communities&gt;</code></small><br>
<h2><br>
</h2>
</body>
</html>
